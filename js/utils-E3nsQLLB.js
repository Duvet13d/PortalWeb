const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/widgets-_876Yqf-.js","js/react-vendor-BlsGRQ4b.js","js/vendor-bMAKmOd3.js","js/motion-SEeoIC92.js","js/contexts-DAReFMRA.js","js/homepage-BHehd6zr.js","js/tools-DQ9o8LN-.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,r,s)=>((t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s)(t,"symbol"!=typeof r?r+"":r,s);import{R as r,j as s,r as a}from"./react-vendor-BlsGRQ4b.js";import{a as i,u as n}from"./contexts-DAReFMRA.js";import{b as o,S as c,P as l,T as d}from"./widgets-_876Yqf-.js";import{m as h}from"./motion-SEeoIC92.js";const u={},p=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/PortalWeb/"+e}(e))in u)return;u[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,r&&a.setAttribute("nonce",r),document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};class m{constructor(){this.algorithm="AES-GCM",this.keyLength=256,this.ivLength=12}async deriveKey(e,t){const r=new TextEncoder,s=await crypto.subtle.importKey("raw",r.encode(e),"PBKDF2",!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},s,{name:this.algorithm,length:this.keyLength},!1,["encrypt","decrypt"])}generateSalt(){return crypto.getRandomValues(new Uint8Array(16))}generateIV(){return crypto.getRandomValues(new Uint8Array(this.ivLength))}async encrypt(e,t){try{const r=new TextEncoder,s=this.generateSalt(),a=this.generateIV(),i=await this.deriveKey(t,s),n=await crypto.subtle.encrypt({name:this.algorithm,iv:a},i,r.encode(JSON.stringify(e))),o=new Uint8Array(s.length+a.length+n.byteLength);return o.set(s,0),o.set(a,s.length),o.set(new Uint8Array(n),s.length+a.length),btoa(String.fromCharCode(...o))}catch(r){throw new Error("Failed to encrypt data")}}async decrypt(e,t){try{const r=new Uint8Array(atob(e).split("").map(e=>e.charCodeAt(0))),s=r.slice(0,16),a=r.slice(16,16+this.ivLength),i=r.slice(16+this.ivLength),n=await this.deriveKey(t,s),o=await crypto.subtle.decrypt({name:this.algorithm,iv:a},n,i),c=new TextDecoder;return JSON.parse(c.decode(o))}catch(r){throw new Error("Failed to decrypt data - invalid password or corrupted data")}}}const g=new class{constructor(e={}){this.prefix=e.prefix||"homepage_",this.version=e.version||"1.0.0",this.encryption=new m,this.sensitiveKeys=new Set(e.sensitiveKeys||["spotify-tokens","api-keys","personal-notes","private-links"]),this.migrationHandlers=new Map,this.backupInterval=e.backupInterval||864e5,this.maxBackups=e.maxBackups||5,this.init()}async init(){await this.runMigrations(),this.setupAutoBackup(),this.cleanupOldBackups()}isSensitive(e){return this.sensitiveKeys.has(e)||e.includes("password")||e.includes("token")}getStorageKey(e){return`${this.prefix}${e}`}async set(e,t,r={}){try{const s=this.getStorageKey(e),a={version:this.version,timestamp:Date.now(),encrypted:!1,checksum:null};let i=t;if(this.isSensitive(e)&&(r.password||r.encrypt)){if(!r.password)throw new Error("Password required for sensitive data");i=await this.encryption.encrypt(t,r.password),a.encrypted=!0}a.checksum=await this.generateChecksum(JSON.stringify(t));const n={data:i,metadata:a};return localStorage.setItem(s,JSON.stringify(n)),!1!==r.backup&&await this.createBackup(e,t,a),!0}catch(s){throw s}}async get(e,t={}){try{const r=this.getStorageKey(e),s=localStorage.getItem(r);if(!s)return null;const a=JSON.parse(s),{data:i,metadata:n}=a;if(n.checksum&&!n.encrypted){if(await this.generateChecksum(JSON.stringify(i))!==n.checksum)return await this.restoreFromBackup(e,t)}if(n.encrypted){if(!t.password)throw new Error("Password required to decrypt sensitive data");return await this.encryption.decrypt(i,t.password)}return i}catch(r){if(!1!==t.fallbackToBackup)return await this.restoreFromBackup(e,t);throw r}}remove(e){try{const t=this.getStorageKey(e);return localStorage.removeItem(t),this.removeBackups(e),!0}catch(t){return!1}}clear(){try{return Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e)),this.clearAllBackups(),!0}catch(e){return!1}}async generateChecksum(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("")}async exportData(e={}){try{const r={version:this.version,timestamp:Date.now(),data:{},metadata:{encrypted:e.encrypt||!1,includeBackups:e.includeBackups||!1}},s=Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).map(e=>e.replace(this.prefix,""));for(const a of s)try{const t=await this.get(a,{password:e.password,fallbackToBackup:!1});null!==t&&(r.data[a]=t)}catch(t){r.data[a]={error:t.message}}if(e.includeBackups&&(r.backups=await this.exportBackups()),e.encrypt&&e.password){const t=await this.encryption.encrypt(r,e.password);return{encrypted:!0,version:this.version,data:t}}return r}catch(t){throw t}}async importData(e,t={}){try{let s=e;if(e.encrypted&&t.password&&(s=await this.encryption.decrypt(e.data,t.password)),!s.version||!s.data)throw new Error("Invalid import data format");if(s.version!==this.version&&!t.force)throw new Error(`Version mismatch: expected ${this.version}, got ${s.version}`);const a={success:[],failed:[],skipped:[]};for(const[e,i]of Object.entries(s.data))try{if(i.error){a.skipped.push({key:e,reason:"Export error: "+i.error});continue}if(!t.overwrite&&await this.get(e,{fallbackToBackup:!1})){a.skipped.push({key:e,reason:"Key already exists"});continue}await this.set(e,i,{password:t.password,backup:!1!==t.createBackup}),a.success.push(e)}catch(r){a.failed.push({key:e,error:r.message})}return s.backups&&t.importBackups&&await this.importBackups(s.backups),a}catch(r){throw r}}async createBackup(e,t,r){try{const s=`${this.prefix}backup_${e}_${Date.now()}`,a={originalKey:e,data:t,metadata:r,backupTimestamp:Date.now()};localStorage.setItem(s,JSON.stringify(a)),await this.cleanupKeyBackups(e)}catch(s){}}async restoreFromBackup(e,t={}){try{const t=this.getKeyBackups(e);if(0===t.length)return null;return t[0].data}catch(r){return null}}getKeyBackups(e){const t=`${this.prefix}backup_${e}_`;return Object.keys(localStorage).filter(e=>e.startsWith(t)).map(e=>{try{return JSON.parse(localStorage.getItem(e))}catch{return null}}).filter(e=>null!==e).sort((e,t)=>t.backupTimestamp-e.backupTimestamp)}async cleanupKeyBackups(e){this.getKeyBackups(e);const t=Object.keys(localStorage).filter(t=>t.startsWith(`${this.prefix}backup_${e}_`)).sort();if(t.length>this.maxBackups){t.slice(0,t.length-this.maxBackups).forEach(e=>localStorage.removeItem(e))}}removeBackups(e){const t=`${this.prefix}backup_${e}_`;Object.keys(localStorage).filter(e=>e.startsWith(t)).forEach(e=>localStorage.removeItem(e))}clearAllBackups(){const e=`${this.prefix}backup_`;Object.keys(localStorage).filter(t=>t.startsWith(e)).forEach(e=>localStorage.removeItem(e))}async exportBackups(){const e=`${this.prefix}backup_`,t={};return Object.keys(localStorage).filter(t=>t.startsWith(e)).forEach(e=>{try{t[e]=JSON.parse(localStorage.getItem(e))}catch(r){}}),t}async importBackups(e){for(const[r,s]of Object.entries(e))try{localStorage.setItem(r,JSON.stringify(s))}catch(t){}}setupAutoBackup(){setInterval(async()=>{try{const e=await this.exportData({includeBackups:!1}),t=`${this.prefix}auto_backup_${Date.now()}`;localStorage.setItem(t,JSON.stringify(e)),this.cleanupAutoBackups()}catch(e){}},this.backupInterval)}cleanupAutoBackups(){const e=`${this.prefix}auto_backup_`,t=Object.keys(localStorage).filter(t=>t.startsWith(e)).sort();if(t.length>this.maxBackups){t.slice(0,t.length-this.maxBackups).forEach(e=>localStorage.removeItem(e))}}cleanupOldBackups(){const e=Date.now();Object.keys(localStorage).filter(e=>e.startsWith(`${this.prefix}backup_`)).forEach(t=>{try{const r=JSON.parse(localStorage.getItem(t));r.backupTimestamp&&e-r.backupTimestamp>6048e5&&localStorage.removeItem(t)}catch(r){localStorage.removeItem(t)}})}addMigration(e,t,r){const s=`${e}->${t}`;this.migrationHandlers.set(s,r)}async runMigrations(){try{const e=this.getCurrentStorageVersion();if(e===this.version)return;for(const[t,r]of this.migrationHandlers){const[s,a]=t.split("->");this.shouldRunMigration(e,s,a)&&await r(this)}this.setStorageVersion(this.version)}catch(e){throw e}}getCurrentStorageVersion(){try{const e=`${this.prefix}version`;return localStorage.getItem(e)||"0.0.0"}catch{return"0.0.0"}}setStorageVersion(e){const t=`${this.prefix}version`;localStorage.setItem(t,e)}shouldRunMigration(e,t,r){return e===t||e<r&&e>=t}getStorageStats(){const e={totalKeys:0,encryptedKeys:0,totalSize:0,backupCount:0,oldestBackup:null,newestBackup:null};return Object.keys(localStorage).forEach(t=>{var r;if(t.startsWith(this.prefix)){e.totalKeys++;try{const s=localStorage.getItem(t);if(e.totalSize+=s.length,t.includes("backup_")){e.backupCount++;const t=JSON.parse(s);t.backupTimestamp&&((!e.oldestBackup||t.backupTimestamp<e.oldestBackup)&&(e.oldestBackup=t.backupTimestamp),(!e.newestBackup||t.backupTimestamp>e.newestBackup)&&(e.newestBackup=t.backupTimestamp))}else{(null==(r=JSON.parse(s).metadata)?void 0:r.encrypted)&&e.encryptedKeys++}}catch(s){}}}),e}}({prefix:"homepage_enhanced_",version:"1.0.0",sensitiveKeys:["spotify-tokens","api-keys","weather-api-key","personal-notes","private-links","user-credentials"]});g.addMigration("0.0.0","1.0.0",async e=>{const t=["homepage-widgets","homepage-theme","homepage-notes","custom-links"];for(const s of t){const t=localStorage.getItem(s);if(t)try{const r=JSON.parse(t),a=s.replace("homepage-","").replace("-","_");await e.set(a,r,{backup:!0})}catch(r){}}});const f={trapFocus:e=>{const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],s=t[t.length-1],a=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===r&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),r.focus()))};return e.addEventListener("keydown",a),r&&r.focus(),()=>{e.removeEventListener("keydown",a)}},saveFocus:()=>document.activeElement,restoreFocus:e=>{e&&e.focus&&e.focus()},focusFirstError:e=>{const t=e.querySelector('[aria-invalid="true"], .error');t&&t.focus()}},y={announce:(e,t="polite")=>{const r=document.createElement("div");r.setAttribute("aria-live",t),r.setAttribute("aria-atomic","true"),r.className="sr-only",r.textContent=e,document.body.appendChild(r),setTimeout(()=>{document.body.removeChild(r)},1e3)},setExpanded:(e,t)=>{e.setAttribute("aria-expanded",t.toString())},setPressed:(e,t)=>{e.setAttribute("aria-pressed",t.toString())},setSelected:(e,t)=>{e.setAttribute("aria-selected",t.toString())},setInvalid:(e,t,r="")=>{if(e.setAttribute("aria-invalid",t.toString()),t&&r){const t=`${e.id||"field"}-error`;let s=document.getElementById(t);s||(s=document.createElement("div"),s.id=t,s.className="sr-only",e.parentNode.appendChild(s)),s.textContent=r,e.setAttribute("aria-describedby",t)}else{e.removeAttribute("aria-describedby");const t=document.getElementById(`${e.id||"field"}-error`);t&&t.remove()}}},w={handleArrowNavigation:(e,t,r,s)=>{let a=r;switch(e.key){case"ArrowDown":e.preventDefault(),a=r<t.length-1?r+1:0;break;case"ArrowUp":e.preventDefault(),a=r>0?r-1:t.length-1;break;case"Home":e.preventDefault(),a=0;break;case"End":e.preventDefault(),a=t.length-1;break;default:return}s(a),t[a]&&t[a].focus&&t[a].focus()},handleActivation:(e,t)=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())}},x={createSkipLink:(e,t="Skip to main content")=>{const r=document.createElement("a");return r.href=`#${e}`,r.textContent=t,r.className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-accent-1 focus:text-white focus:rounded-lg focus:no-underline",document.body.insertBefore(r,document.body.firstChild),r}};class v extends r.Component{constructor(e){super(e),t(this,"handleRetry",()=>{this.setState(e=>({hasError:!1,error:null,errorInfo:null,retryCount:e.retryCount+1}))}),this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),this.props.onError&&this.props.onError(e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback(this.state.error,this.handleRetry):s.jsxs(h.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:`p-4 rounded-lg border border-red-500/50 bg-red-900/20 ${this.props.className||""}`,children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("svg",{className:"w-5 h-5 text-red-400 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"text-red-400 font-medium text-sm",children:this.props.title||"Something went wrong"}),s.jsx("p",{className:"text-gray-300 text-xs mt-1",children:this.props.message||"An unexpected error occurred. Please try again."}),this.props.showDetails&&this.state.error&&s.jsxs("details",{className:"mt-2",children:[s.jsx("summary",{className:"text-xs text-gray-400 cursor-pointer hover:text-gray-300",children:"Error details"}),s.jsx("pre",{className:"text-xs text-gray-500 mt-1 overflow-auto max-h-20",children:this.state.error.toString()})]})]})]}),!1!==this.props.showRetry&&s.jsxs("div",{className:"mt-3 flex gap-2",children:[s.jsx("button",{onClick:this.handleRetry,className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"Try Again"}),this.props.onReset&&s.jsx("button",{onClick:this.props.onReset,className:"px-3 py-1 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"Reset"})]})]}):this.props.children}}const k=({widgetId:e,widgetName:t,children:r,onError:a,fallbackData:i=null,enableOfflineMode:n=!0})=>s.jsx(v,{name:`Widget: ${t||e}`,onError:(r,s)=>{if("undefined"!=typeof window){const s=JSON.parse(localStorage.getItem("widget-errors")||"[]");s.push({widgetId:e,widgetName:t,error:r.toString(),timestamp:Date.now(),userAgent:navigator.userAgent}),localStorage.setItem("widget-errors",JSON.stringify(s.slice(-10)))}null==a||a(r,s)},fallback:(r,a)=>s.jsx("div",{className:"min-h-[120px] flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center max-w-sm",children:[s.jsx("div",{className:"w-12 h-12 mx-auto mb-3 text-red-400",children:s.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),s.jsxs("h3",{className:"text-red-400 font-medium text-sm mb-2",children:[t||e," Widget Error"]}),s.jsx("p",{className:"text-gray-400 text-xs mb-4",children:"This widget encountered an error and couldn't load properly."}),i&&s.jsxs("div",{className:"mb-4 p-3 bg-gray-800/50 rounded-lg",children:[s.jsx("p",{className:"text-gray-300 text-xs mb-2",children:"Showing cached data:"}),s.jsx("div",{className:"text-gray-400 text-xs",children:"string"==typeof i?i:JSON.stringify(i,null,2)})]}),s.jsxs("div",{className:"flex gap-2 justify-center",children:[s.jsx("button",{onClick:a,className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded transition-colors",children:"Retry Widget"}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-3 py-1 text-xs bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"Reload Page"})]})]})}),children:r}),b=({toolName:e,children:t,onError:r,onClose:a,enableReporting:i=!0})=>s.jsx(v,{name:`Tool: ${e}`,onError:(t,s)=>{if("undefined"!=typeof window&&i){const r=JSON.parse(localStorage.getItem("tool-errors")||"[]");r.push({toolName:e,error:t.toString(),stack:t.stack,timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href}),localStorage.setItem("tool-errors",JSON.stringify(r.slice(-20)))}null==r||r(t,s)},fallback:(t,r)=>s.jsx("div",{className:"min-h-[300px] flex items-center justify-center p-6",children:s.jsxs("div",{className:"text-center max-w-md",children:[s.jsx("div",{className:"w-16 h-16 mx-auto mb-4 text-red-400",children:s.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),s.jsxs("h3",{className:"text-red-400 font-semibold text-lg mb-2",children:[e," Tool Error"]}),s.jsxs("p",{className:"text-gray-400 text-sm mb-6",children:["The ",e," tool encountered an unexpected error and couldn't load properly. This might be due to a temporary issue or corrupted data."]}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 text-sm bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"Retry Tool"}),s.jsx("button",{onClick:a,className:"px-4 py-2 text-sm bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Close Tool"})]}),s.jsxs("details",{className:"mt-6 text-left",children:[s.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer hover:text-gray-400 mb-2",children:"Technical Details"}),s.jsxs("div",{className:"p-3 bg-gray-800/50 rounded-lg text-xs text-gray-400",children:[s.jsxs("div",{className:"mb-2",children:[s.jsx("strong",{children:"Error:"})," ",t.toString()]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Time:"})," ",(new Date).toLocaleString()]})]})]})]})}),children:t}),S=({pageName:e,children:t,onError:r})=>s.jsx(v,{name:`Page: ${e}`,title:"Page Error",message:"This page encountered an error and couldn't load properly",className:"min-h-[50vh] flex items-center justify-center",onError:r,showRetry:!0,showDetails:!0,children:t}),E=()=>{const[e,t]=a.useState(navigator.onLine),[r,s]=a.useState(!1);return a.useEffect(()=>{const e=()=>{t(!0),r&&(window.dispatchEvent(new CustomEvent("app:reconnected")),s(!1))},a=()=>{t(!1),s(!0),window.dispatchEvent(new CustomEvent("app:disconnected"))};return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}},[r]),{isOnline:e,wasOffline:r}};class N{constructor(e={}){this.retryAttempts=e.retryAttempts||3,this.retryDelay=e.retryDelay||1e3,this.cacheTimeout=e.cacheTimeout||3e5,this.enableCache=!1!==e.enableCache}async fetch(e,t={}){const r=this.getCacheKey(e,t);if(navigator.onLine)try{const s=await this.fetchWithRetry(e,t);return s.ok&&this.enableCache&&await this.cacheResponse(r,s.clone()),s}catch(a){return await this.getCachedResponse(r)||this.createOfflineResponse()}const s=await this.getCachedResponse(r);return s||this.createOfflineResponse()}async fetchWithRetry(e,t,r=1){try{const r=new AbortController,s=setTimeout(()=>r.abort(),1e4),a=await fetch(e,{...t,signal:r.signal});if(clearTimeout(s),!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);return a}catch(s){if(r<this.retryAttempts)return await this.delay(this.retryDelay*r),this.fetchWithRetry(e,t,r+1);throw s}}getCacheKey(e,t){const r=t.method||"GET",s=t.body?JSON.stringify(t.body):"";return`fetch_cache_${r}_${e}_${btoa(s).slice(0,10)}`}async cacheResponse(e,t){try{const r={data:await t.text(),headers:Object.fromEntries(t.headers.entries()),status:t.status,statusText:t.statusText,timestamp:Date.now()};localStorage.setItem(e,JSON.stringify(r))}catch(r){}}async getCachedResponse(e){try{const t=localStorage.getItem(e);if(!t)return null;const r=JSON.parse(t);return Date.now()-r.timestamp>this.cacheTimeout?(localStorage.removeItem(e),null):new Response(r.data,{status:r.status,statusText:r.statusText,headers:new Headers(r.headers)})}catch(t){return null}}createOfflineResponse(){return new Response(JSON.stringify({error:"offline",message:"No network connection available"}),{status:503,statusText:"Service Unavailable",headers:new Headers({"Content-Type":"application/json"})})}delay(e){return new Promise(t=>setTimeout(t,e))}}new N;const j=(e={})=>{const{isOnline:t}=E(),[r]=a.useState(()=>new N(e));return{fetchData:a.useCallback(async(e,t={})=>await r.fetch(e,t),[r]),isOnline:t}};const C=new class{constructor(e="offline_"){this.prefix=e}set(e,t,r=36e5){try{const s={data:t,timestamp:Date.now(),ttl:r};return localStorage.setItem(this.prefix+e,JSON.stringify(s)),!0}catch(s){return!1}}get(e){try{const t=localStorage.getItem(this.prefix+e);if(!t)return null;const r=JSON.parse(t);return Date.now()-r.timestamp>r.ttl?(this.remove(e),null):r.data}catch(t){return null}}remove(e){try{return localStorage.removeItem(this.prefix+e),!0}catch(t){return!1}}clear(){try{return Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(e=>localStorage.removeItem(e)),!0}catch(e){return!1}}getAll(){try{const e={};return Object.keys(localStorage).filter(e=>e.startsWith(this.prefix)).forEach(t=>{const r=t.replace(this.prefix,""),s=this.get(r);null!==s&&(e[r]=s)}),e}catch(e){return{}}}}("homepage_offline_");new class{constructor(){this.isOfflineMode=!1,this.offlineData=new Map,this.listeners=new Set,this.init()}init(){window.addEventListener("online",()=>{this.setOfflineMode(!1),this.notifyListeners("online")}),window.addEventListener("offline",()=>{this.setOfflineMode(!0),this.notifyListeners("offline")}),this.setOfflineMode(!navigator.onLine)}setOfflineMode(e){this.isOfflineMode=e,document.body.classList.toggle("offline-mode",e)}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(e){this.listeners.forEach(t=>t(e,this.isOfflineMode))}storeOfflineData(e,t){this.offlineData.set(e,{data:t,timestamp:Date.now()})}getOfflineData(e){var t;return null==(t=this.offlineData.get(e))?void 0:t.data}clearExpiredData(e=36e5){const t=Date.now();for(const[r,s]of this.offlineData.entries())t-s.timestamp>e&&this.offlineData.delete(r)}};const O={STANDARD:{attempts:3,delay:1e3,backoff:2}},A=async(e,t=O.STANDARD)=>{const{attempts:r,delay:s,backoff:a}=t;let i;for(let o=1;o<=r;o++)try{return await e(o)}catch(n){if(i=n,T(n))throw n;if(o<r){const e=s*Math.pow(a,o-1);await I(e)}}throw i};new class{constructor(e={}){this.queue=[],this.processing=!1,this.maxConcurrent=e.maxConcurrent||3,this.defaultConfig=e.defaultConfig||O.STANDARD}add(e,t=this.defaultConfig){return new Promise((r,s)=>{this.queue.push({operation:e,config:t,resolve:r,reject:s,id:Date.now()+Math.random()}),this.process()})}async process(){if(this.processing||0===this.queue.length)return;this.processing=!0;const e=[];for(;this.queue.length>0&&e.length<this.maxConcurrent;){const t=this.queue.shift();e.push(this.processItem(t))}await Promise.allSettled(e),this.processing=!1,this.queue.length>0&&this.process()}async processItem(e){try{const t=await A(e.operation,e.config);e.resolve(t)}catch(t){e.reject(t)}}clear(){this.queue.forEach(e=>{e.reject(new Error("Queue cleared"))}),this.queue=[]}size(){return this.queue.length}};const I=e=>new Promise(t=>setTimeout(t,e)),T=e=>!!["AbortError","TypeError","SyntaxError","ReferenceError"].includes(e.name)||e.status>=400&&e.status<500&&![408,429].includes(e.status),D="network_error",_="timeout",B="server_error",K="rate_limited",$="unauthorized",L="not_found",R="offline";const z=new class{constructor(){this.errorCounts=new Map,this.lastErrors=new Map,this.circuitBreakers=new Map}async handleAPICall(e,t={}){const{cacheKey:r,fallbackData:s,retryConfig:a=O.STANDARD,enableCircuitBreaker:i=!0,notifyUser:n=!0}=t;try{if(i&&this.isCircuitOpen(r))throw new Error("Circuit breaker is open");const t=await A(e,a);return this.resetErrorCount(r),t}catch(o){if(this.trackError(r,o),r){const e=C.get(r);if(e)return this.createCachedResponse(e)}if(s)return this.createFallbackResponse(s);throw n&&this.notifyUser(o,r),o}}trackError(e,t){if(!e)return;const r=this.errorCounts.get(e)||0;this.errorCounts.set(e,r+1),this.lastErrors.set(e,{error:t,timestamp:Date.now(),type:this.categorizeError(t)}),r>=4&&this.circuitBreakers.set(e,{isOpen:!0,openedAt:Date.now(),resetTimeout:6e4})}resetErrorCount(e){e&&(this.errorCounts.delete(e),this.circuitBreakers.delete(e))}isCircuitOpen(e){if(!e)return!1;const t=this.circuitBreakers.get(e);return!(!t||!t.isOpen)&&(!(Date.now()-t.openedAt>t.resetTimeout)||(this.circuitBreakers.delete(e),!1))}categorizeError(e){var t,r;if(!navigator.onLine)return R;if("AbortError"===e.name)return _;if(null==(t=e.message)?void 0:t.includes("timeout"))return _;const s=e.status||(null==(r=e.response)?void 0:r.status);return s>=500?B:429===s?K:401===s||403===s?$:404===s?L:D}createCachedResponse(e){return new Response(JSON.stringify(e),{status:200,statusText:"OK (Cached)",headers:new Headers({"Content-Type":"application/json","X-Cached-Response":"true","X-Cache-Source":"offline-storage"})})}createFallbackResponse(e){return new Response(JSON.stringify(e),{status:200,statusText:"OK (Fallback)",headers:new Headers({"Content-Type":"application/json","X-Fallback-Response":"true"})})}notifyUser(e,t){const r=this.categorizeError(e),s=this.getErrorMessage(r,t);"Notification"in window&&"granted"===Notification.permission&&new Notification("API Error",{body:s,icon:"/favi.svg",tag:`api-error-${t}`,silent:!0}),window.dispatchEvent(new CustomEvent("api:error",{detail:{error:e,apiName:t,errorType:r,message:s}}))}getErrorMessage(e,t="Service"){return{[R]:`${t} is unavailable while offline. Using cached data.`,[_]:`${t} is taking too long to respond. Please try again.`,[B]:`${t} is experiencing issues. Using cached data.`,[K]:`${t} rate limit exceeded. Please wait before trying again.`,[$]:`${t} access denied. Please check your credentials.`,[L]:`${t} endpoint not found.`,[D]:`Network error accessing ${t}. Using cached data.`}[e]||`${t} is currently unavailable.`}getErrorStats(){const e={};for(const[t,r]of this.errorCounts.entries()){const s=this.lastErrors.get(t),a=this.circuitBreakers.get(t);e[t]={errorCount:r,lastError:s?{type:s.type,message:s.error.message,timestamp:s.timestamp}:null,circuitBreakerOpen:(null==a?void 0:a.isOpen)||!1}}return e}};const P=new class{constructor(){this.notifications=new Map,this.maxNotifications=5,this.notificationTimeout=5e3}notify(e,t,r){const s=`${e}-${t}-${Date.now()}`,a=`${e}-${t}`;if(this.notifications.has(a))return;const i={id:s,apiName:e,errorType:t,message:r,timestamp:Date.now()};if(this.notifications.set(a,i),window.dispatchEvent(new CustomEvent("api:notification",{detail:i})),setTimeout(()=>{this.notifications.delete(a),window.dispatchEvent(new CustomEvent("api:notification:remove",{detail:{id:s}}))},this.notificationTimeout),this.notifications.size>this.maxNotifications){const e=this.notifications.keys().next().value;this.notifications.delete(e)}}clearAll(){this.notifications.clear(),window.dispatchEvent(new CustomEvent("api:notifications:clear"))}getNotifications(){return Array.from(this.notifications.values())}};const W=new class{constructor(){this.migrationStatus={completed:!1,errors:[],migrated:[],skipped:[]}}async checkMigrationNeeded(){const e=["homepage-widgets","homepage-theme","homepage-notes","custom-links","notes-settings"].some(e=>null!==localStorage.getItem(e)),t=await g.get("migration_completed");return e&&!t}async performMigration(e={}){try{const r=[{oldKey:"homepage-widgets",newKey:"widgets",transform:e=>e},{oldKey:"homepage-theme",newKey:"theme",transform:e=>e},{oldKey:"homepage-notes",newKey:"personal_notes",transform:e=>e,sensitive:!0},{oldKey:"custom-links",newKey:"custom_links",transform:e=>e},{oldKey:"notes-settings",newKey:"notes_settings",transform:e=>e}];for(const s of r)try{const t=localStorage.getItem(s.oldKey);if(t){const r=JSON.parse(t),a=s.transform(r);await g.set(s.newKey,a,{backup:!0,encrypt:s.sensitive&&e.encryptSensitive}),this.migrationStatus.migrated.push({from:s.oldKey,to:s.newKey,encrypted:s.sensitive&&e.encryptSensitive}),e.removeOldData&&localStorage.removeItem(s.oldKey)}else this.migrationStatus.skipped.push({key:s.oldKey,reason:"No data found"})}catch(t){this.migrationStatus.errors.push({key:s.oldKey,error:t.message})}return await g.set("migration_completed",{timestamp:Date.now(),version:"1.0.0",status:this.migrationStatus}),this.migrationStatus.completed=!0,this.migrationStatus}catch(t){throw t}}getMigrationStatus(){return this.migrationStatus}async rollbackMigration(){try{const e=await g.get("migration_completed");if(!e)throw new Error("No migration record found");const t=e.status.migrated.map(e=>e.to);for(const r of t)g.remove(r);return g.remove("migration_completed"),!0}catch(e){throw e}}async cleanupOldData(){try{const e=await g.get("migration_completed");if(!e)throw new Error("No migration record found");const t=e.status.migrated.map(e=>e.from);for(const r of t)localStorage.removeItem(r);return!0}catch(e){throw e}}};const M=new class{constructor(){this.currentVersion="1.0.0",this.githubRepo="yourusername/PortalWeb",this.checkInterval=864e5,this.lastCheckKey="personal-portal-last-update-check",this.updateAvailableKey="personal-portal-update-available"}async checkForUpdates(e=!1){try{const t=localStorage.getItem(this.lastCheckKey),r=Date.now();if(!e&&t&&r-parseInt(t)<this.checkInterval)return this.getStoredUpdateInfo();const s=await fetch(`https://api.github.com/repos/${this.githubRepo}/releases/latest`);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const a=await s.json(),i=a.tag_name.replace(/^v/,"");localStorage.setItem(this.lastCheckKey,r.toString());const n={available:this.compareVersions(this.currentVersion,i)<0,currentVersion:this.currentVersion,latestVersion:i,releaseUrl:a.html_url,releaseNotes:a.body,publishedAt:a.published_at,lastChecked:r};return localStorage.setItem(this.updateAvailableKey,JSON.stringify(n)),n}catch(t){return{available:!1,error:t.message,lastChecked:Date.now()}}}getStoredUpdateInfo(){try{const e=localStorage.getItem(this.updateAvailableKey);return e?JSON.parse(e):{available:!1}}catch(e){return{available:!1}}}compareVersions(e,t){const r=e.split(".").map(Number),s=t.split(".").map(Number),a=Math.max(r.length,s.length);for(let i=0;i<a;i++){const e=r[i]||0,t=s[i]||0;if(e<t)return-1;if(e>t)return 1}return 0}initAutoCheck(){this.checkForUpdates(),setInterval(()=>{this.checkForUpdates()},this.checkInterval),document.addEventListener("visibilitychange",()=>{if(!document.hidden){const e=localStorage.getItem(this.lastCheckKey),t=Date.now();(!e||t-parseInt(e)>216e5)&&this.checkForUpdates()}})}dismissUpdate(){const e=this.getStoredUpdateInfo();e.dismissed=!0,e.dismissedAt=Date.now(),localStorage.setItem(this.updateAvailableKey,JSON.stringify(e))}shouldShowUpdateNotification(){const e=this.getStoredUpdateInfo();if(!e.available)return!1;if(e.dismissed){const t=Date.now()-6048e5;return e.dismissedAt<t}return!0}getUpdateNotificationData(){const e=this.getStoredUpdateInfo();return this.shouldShowUpdateNotification()?{message:`Personal Portal v${e.latestVersion} is available!`,currentVersion:e.currentVersion,latestVersion:e.latestVersion,releaseUrl:e.releaseUrl,releaseNotes:e.releaseNotes,publishedAt:new Date(e.publishedAt).toLocaleDateString()}:null}async refreshApplication(){try{if("serviceWorker"in navigator&&"caches"in window){const e=await caches.keys();await Promise.all(e.map(e=>caches.delete(e)))}window.location.reload(!0)}catch(e){window.location.reload()}}},J=async()=>null,U=async()=>[],V=()=>"";const F=new class{constructor(){this.widgets=new Map,this.initialized=!1}register(e){const{id:t,type:r,component:s,defaultSize:a,configurable:i,settings:n,metadata:o}=e;if(!t||!r||!s)throw new Error("Widget must have id, type, and component");this.widgets.has(t),this.widgets.set(t,{id:t,type:r,component:s,defaultSize:a||"medium",configurable:!1!==i,settings:n||{},metadata:o||{},registered:(new Date).toISOString()})}get(e){return this.widgets.get(e)||null}getByType(e){return Array.from(this.widgets.values()).filter(t=>t.type===e)}getAll(){return Array.from(this.widgets.values())}has(e){return this.widgets.has(e)}unregister(e){return this.widgets.delete(e)}getComponent(e){const t=this.get(e);return t?t.component:null}getAvailableWidgets(e={}){const{size:t,configurable:r,types:s}=e;return this.getAll().filter(e=>(!t||e.defaultSize===t)&&((void 0===r||e.configurable===r)&&!(s&&Array.isArray(s)&&!s.includes(e.type))))}initialize(){this.initialized||(this.registerPlaceholderWidgets(),this.initialized=!0)}registerPlaceholderWidgets(){[{id:"weather-widget",type:i.WEATHER,component:o,defaultSize:"large",configurable:!0,metadata:{name:"Weather",description:"Current weather and forecast",icon:"cloud"}},{id:"spotify-widget",type:i.SPOTIFY,component:c,defaultSize:"medium",configurable:!0,metadata:{name:"Spotify",description:"Now playing and music controls",icon:"music"}},{id:"quicklinks-widget",type:i.QUICK_LINKS,component:l,defaultSize:"large",configurable:!0,metadata:{name:"Quick Links",description:"Your favorite bookmarks",icon:"link"}},{id:"timezone-widget",type:i.TIMEZONE,component:d,defaultSize:"large",configurable:!0,metadata:{name:"World Clock",description:"Current time in different timezones",icon:"globe"}}].forEach(e=>this.register(e))}getStats(){const e=this.getAll(),t={};return e.forEach(e=>{t[e.type]=(t[e.type]||0)+1}),{total:e.length,byType:t,configurable:e.filter(e=>e.configurable).length,initialized:this.initialized}}};a.lazy(()=>p(()=>import("./widgets-_876Yqf-.js").then(e=>e.c),__vite__mapDeps([0,1,2,3,4,5]))),a.lazy(()=>p(()=>import("./widgets-_876Yqf-.js").then(e=>e.d),__vite__mapDeps([0,1,2,3,4,5]))),a.lazy(()=>p(()=>import("./widgets-_876Yqf-.js").then(e=>e.e),__vite__mapDeps([0,1,2,3,4,5]))),a.lazy(()=>p(()=>import("./tools-DQ9o8LN-.js").then(e=>e.b),__vite__mapDeps([6,1,2,3]))),a.lazy(()=>p(()=>import("./tools-DQ9o8LN-.js").then(e=>e.c),__vite__mapDeps([6,1,2,3]))),a.lazy(()=>p(()=>import("./tools-DQ9o8LN-.js").then(e=>e.d),__vite__mapDeps([6,1,2,3]))),a.lazy(()=>p(()=>import("./contexts-DAReFMRA.js").then(e=>e.d),__vite__mapDeps([4,1,2,3])));const q=({height:e="200px",width:t="100%"})=>s.jsx("div",{className:"animate-pulse bg-gray-800/50 rounded-lg border border-gray-700/50 flex items-center justify-center",style:{height:e,width:t},children:s.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-red-500/30 border-t-red-500 rounded-full animate-spin"}),s.jsx("span",{className:"text-gray-400 text-sm",children:"Loading..."})]})}),H=()=>s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsxs("div",{className:"flex flex-col items-center space-y-3",children:[s.jsx("div",{className:"w-10 h-10 border-3 border-red-500/30 border-t-red-500 rounded-full animate-spin"}),s.jsx("span",{className:"text-gray-300",children:"Loading tool..."})]})});class Q{static create(e,t={}){const r=F.get(e);if(!r)return Q.createFallback(e,t);const{component:i,metadata:o,defaultSize:c}=r,l=l=>{var d;const{getWidgetSettings:h,updateWidgetSettings:u}=n(),{loadWidget:p}={loadWidget:(e,t={})=>r=>s.jsx(a.Suspense,{fallback:s.jsx(q,{...t}),children:s.jsx(e,{...r})}),loadTool:e=>t=>s.jsx(a.Suspense,{fallback:s.jsx(H,{}),children:s.jsx(e,{...t})})},m=h(r.type),g={...t,...l,widgetId:e,settings:m,metadata:o,size:t.size||c,onSettingsChange:e=>{u(r.type,e)}},f=Q.getSizeHeight(g.size),y=p(i,{height:f,width:"100%"});return s.jsx(k,{widgetId:e,widgetName:(null==(d=r.metadata)?void 0:d.name)||e,children:s.jsx(y,{...g})})};return l.displayName=`Widget(${e})`,l}static getSizeHeight(e){const t={small:"120px",medium:"200px",large:"300px"};return t[e]||t.medium}static createFallback(e,t={}){return r=>s.jsx(l,{title:"Widget Not Found",description:`Widget "${e}" could not be loaded`,size:t.size||"medium",className:"border-red-500/50 bg-red-900/20",icon:s.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-full h-full text-red-400",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),...r})}static createMultiple(e){return e.map(e=>{const{id:t,props:r={}}=e;return{id:t,component:Q.create(t,r),...e}})}static createVisible(e={}){const{size:t,additionalProps:r={}}=e;return()=>{const{getVisibleWidgets:e}=n();return e().map(e=>{const s=F.getByType(e)[0];return s?{id:s.id,type:e,component:Q.create(s.id,{size:t,...r})}:null}).filter(Boolean)}}}export{S as P,b as T,Q as W,p as _,y as a,P as b,j as c,U as d,g as e,f,J as g,z as h,V as i,M as j,w as k,W as m,x as s,E as u,F as w};
